<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Capacity Dashboard | Curro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        header {
            background: #003c72;
            color: white;
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            flex: 1;
        }

        header h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .school-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #f6b242;
            margin-top: 8px;
        }

        .last-updated {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 8px;
        }

        .logo-area {
            font-size: 3em;
            font-weight: 700;
            color: #f6b242;
        }

        .nav-bar {
            background: white;
            padding: 20px 40px;
            border-bottom: 3px solid #f6b242;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .nav-bar a, .nav-bar button {
            padding: 12px 28px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #003c72;
            color: white;
        }

        .btn-primary:hover {
            background: #002a54;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .legend {
            padding: 25px 40px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .legend h3 {
            color: #003c72;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .legend-grid {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .legend-color {
            width: 50px;
            height: 25px;
            border-radius: 6px;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .legend-color.low {
            background: #28a745;
        }

        .legend-color.medium {
            background: #17a2b8;
        }

        .legend-color.high {
            background: #ffc107;
        }

        .legend-color.full {
            background: #f6b242;
        }

        .legend-color.over {
            background: #dc3545;
        }

        .legend-text {
            font-size: 0.95em;
            color: #495057;
            font-weight: 600;
        }

        .dashboard {
            padding: 30px 40px;
            background: #f8f9fa;
        }

        .grade-section {
            margin-bottom: 35px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e0e0e0;
        }

        .grade-header {
            background: #003c72;
            color: white;
            padding: 20px 30px;
            font-size: 1.6em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .grade-header::before {
            content: '';
            width: 5px;
            height: 30px;
            background: #f6b242;
            border-radius: 3px;
        }

        .subject-grid {
            padding: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
        }

        .subject-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            transition: all 0.2s;
        }

        .subject-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #f6b242;
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .subject-name {
            font-weight: 700;
            color: #003c72;
            font-size: 1.1em;
            flex: 1;
            line-height: 1.3;
        }

        .subject-numbers {
            text-align: right;
            margin-left: 15px;
        }

        .current-number {
            font-size: 2em;
            font-weight: 700;
            color: #f6b242;
            line-height: 1;
        }

        .max-number {
            font-size: 0.95em;
            color: #6c757d;
            margin-top: 3px;
            font-weight: 500;
        }

        .capacity-bar-container {
            width: 100%;
            height: 32px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            border: 1px solid #dee2e6;
        }

        .capacity-bar {
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.95em;
            position: relative;
        }

        .capacity-bar.low {
            background: #28a745;
        }

        .capacity-bar.medium {
            background: #17a2b8;
        }

        .capacity-bar.high {
            background: #ffc107;
            color: #000;
        }

        .capacity-bar.full {
            background: #f6b242;
        }

        .capacity-bar.over {
            background: #dc3545;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
        }

        .status-label {
            margin-top: 10px;
            font-size: 0.9em;
            font-weight: 600;
            text-align: center;
        }

        .status-label.low {
            color: #28a745;
        }

        .status-label.medium {
            color: #17a2b8;
        }

        .status-label.high {
            color: #ff9800;
        }

        .status-label.full {
            color: #f6b242;
        }

        .status-label.over {
            color: #dc3545;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            header h1 {
                font-size: 1.8em;
            }

            .nav-bar, .legend, .dashboard {
                padding: 20px;
            }

            .subject-grid {
                grid-template-columns: 1fr;
            }

            .legend-grid {
                justify-content: flex-start;
            }
        }

        @media print {
            body {
                background: white;
            }

            .nav-bar {
                display: none;
            }

            .subject-card {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Student Capacity Dashboard</h1>
                <div class="school-name" id="schoolName">CURRO RIVONIA</div>
                <div class="last-updated" id="lastUpdated"></div>
            </div>
            <div class="logo-area">CURRO</div>
        </header>

        <div class="nav-bar">
            <a href="admin.html" class="btn-primary">
                <span>üîß</span>
                <span>Admin Panel</span>
            </a>
            <button onclick="window.print()" class="btn-secondary">üñ®Ô∏è Print</button>
            <button onclick="location.reload()" class="btn-secondary">üîÑ Refresh</button>
        </div>

        <div class="legend">
            <h3>Capacity Status Legend</h3>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-color low"></div>
                    <span class="legend-text">0-50% Available</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color medium"></div>
                    <span class="legend-text">51-70% Moderate</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color high"></div>
                    <span class="legend-text">71-90% High</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color full"></div>
                    <span class="legend-text">91-100% Full</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color over"></div>
                    <span class="legend-text">Over 100% Over Capacity</span>
                </div>
            </div>
        </div>

        <div class="dashboard" id="dashboard"></div>
    </div>

    <script>
        let studentData = [];
        let capacities = {};

        const initialCSVData = `Brand_Name,Company_Name,Textbox4,Textbox2,Textbox26,Textbox40
Curro,Curro Rivonia,10,Accounting,12,2755
Curro,Curro Rivonia,10,Advanced Programme English,2,2755
Curro,Curro Rivonia,10,Advanced Programme Mathematics,9,2755
Curro,Curro Rivonia,10,Afrikaans First Additional Language,47,2755
Curro,Curro Rivonia,10,Business Studies,45,2755
Curro,Curro Rivonia,10,Computer Applications Technology,29,2755
Curro,Curro Rivonia,10,Engineering Graphics and Design,16,2755
Curro,Curro Rivonia,10,English Home Language,70,2755
Curro,Curro Rivonia,10,History,25,2755
Curro,Curro Rivonia,10,Information Technology,19,2755
Curro,Curro Rivonia,10,isiZulu First Additional Language,18,2755
Curro,Curro Rivonia,10,Life Orientation,70,2755
Curro,Curro Rivonia,10,Life Sciences,24,2755
Curro,Curro Rivonia,10,Mathematical Literacy,34,2755
Curro,Curro Rivonia,10,Mathematics,50,2755
Curro,Curro Rivonia,10,Physical Sciences,33,2755
Curro,Curro Rivonia,10,Tourism,23,2755
Curro,Curro Rivonia,10,Visual Arts,12,2755
Curro,Curro Rivonia,11,Accounting,13,2755
Curro,Curro Rivonia,11,Advanced Programme English,4,2755
Curro,Curro Rivonia,11,Advanced Programme Mathematics,7,2755
Curro,Curro Rivonia,11,Afrikaans First Additional Language,51,2755
Curro,Curro Rivonia,11,Business Studies,36,2755
Curro,Curro Rivonia,11,Computer Applications Technology,14,2755
Curro,Curro Rivonia,11,Economics,3,2755
Curro,Curro Rivonia,11,Engineering Graphics and Design,15,2755
Curro,Curro Rivonia,11,English Home Language,69,2755
Curro,Curro Rivonia,11,Geography,3,2755
Curro,Curro Rivonia,11,History,34,2755
Curro,Curro Rivonia,11,Information Technology,10,2755
Curro,Curro Rivonia,11,isiZulu First Additional Language,17,2755
Curro,Curro Rivonia,11,Life Orientation,69,2755
Curro,Curro Rivonia,11,Life Sciences,30,2755
Curro,Curro Rivonia,11,Mathematical Literacy,30,2755
Curro,Curro Rivonia,11,Mathematics,44,2755
Curro,Curro Rivonia,11,Physical Sciences,27,2755
Curro,Curro Rivonia,11,Tourism,33,2755
Curro,Curro Rivonia,11,Visual Arts,5,2755
Curro,Curro Rivonia,12,Accounting,9,2755
Curro,Curro Rivonia,12,Advanced Programme Mathematics,2,2755
Curro,Curro Rivonia,12,Afrikaans First Additional Language,44,2755
Curro,Curro Rivonia,12,Business Studies,31,2755
Curro,Curro Rivonia,12,Computer Applications Technology,16,2755
Curro,Curro Rivonia,12,Economics,7,2755
Curro,Curro Rivonia,12,Engineering Graphics and Design,13,2755
Curro,Curro Rivonia,12,English Home Language,65,2755
Curro,Curro Rivonia,12,French Second Additional Language,2,2755
Curro,Curro Rivonia,12,Geography,8,2755
Curro,Curro Rivonia,12,History,30,2755
Curro,Curro Rivonia,12,Information Technology,5,2755
Curro,Curro Rivonia,12,isiZulu First Additional Language,15,2755
Curro,Curro Rivonia,12,Life Orientation,64,2755
Curro,Curro Rivonia,12,Life Sciences,27,2755
Curro,Curro Rivonia,12,Mathematical Literacy,37,2755
Curro,Curro Rivonia,12,Mathematics,35,2755
Curro,Curro Rivonia,12,Physical Sciences,18,2755
Curro,Curro Rivonia,12,Portuguese Second Additional Language,1,2755
Curro,Curro Rivonia,12,Tourism,19,2755
Curro,Curro Rivonia,12,Visual Arts,13,2755
Curro,Curro Rivonia,8,Afrikaans First Additional Language,59,2755
Curro,Curro Rivonia,8,Business Studies,74,2755
Curro,Curro Rivonia,8,Coding and Robotics ,74,2755
Curro,Curro Rivonia,8,Creative Arts,74,2755
Curro,Curro Rivonia,8,English Home Language,74,2755
Curro,Curro Rivonia,8,isiZulu First Additional Language,15,2755
Curro,Curro Rivonia,8,Life Orientation,74,2755
Curro,Curro Rivonia,8,Mathematics,74,2755
Curro,Curro Rivonia,8,Natural Sciences,74,2755
Curro,Curro Rivonia,8,Social Sciences,74,2755
Curro,Curro Rivonia,9,Accounting,64,2755
Curro,Curro Rivonia,9,Afrikaans First Additional Language,45,2755
Curro,Curro Rivonia,9,Coding and Robotics ,64,2755
Curro,Curro Rivonia,9,Creative Arts,64,2755
Curro,Curro Rivonia,9,English Home Language,64,2755
Curro,Curro Rivonia,9,isiZulu First Additional Language,19,2755
Curro,Curro Rivonia,9,Life Orientation,64,2755
Curro,Curro Rivonia,9,Mathematics,64,2755
Curro,Curro Rivonia,9,Natural Sciences,64,2755
Curro,Curro Rivonia,9,Social Sciences,64,2755`;

        window.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderDashboard();
        });

        function loadData() {
            const savedData = localStorage.getItem('studentData');
            if (savedData) {
                studentData = JSON.parse(savedData);
            } else {
                parseCSV(initialCSVData);
            }

            const savedCapacities = localStorage.getItem('subjectCapacities');
            if (savedCapacities) {
                capacities = JSON.parse(savedCapacities);
            }

            if (studentData.length > 0) {
                document.getElementById('schoolName').textContent = studentData[0].school.toUpperCase();
            }

            document.getElementById('lastUpdated').textContent = 
                `Last Updated: ${new Date().toLocaleString()}`;
        }

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            studentData = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const parts = lines[i].split(',');
                    if (parts.length >= 6) {
                        const grade = parseInt(parts[2]);
                        const subject = parts[3].trim();
                        const count = parseInt(parts[4]);
                        
                        studentData.push({
                            brand: parts[0].trim(),
                            school: parts[1].trim(),
                            grade: grade,
                            subject: subject,
                            count: count,
                            key: `${grade}-${subject}`
                        });
                    }
                }
            }
        }

        function getCapacityInfo(current, max) {
            if (!max || max === 0) {
                return {
                    percentage: 0,
                    class: 'low',
                    label: 'Capacity Not Set',
                    width: 0
                };
            }

            const percentage = Math.round((current / max) * 100);
            let className, label;

            if (percentage > 100) {
                className = 'over';
                label = 'Over Capacity!';
            } else if (percentage >= 91) {
                className = 'full';
                label = 'Full';
            } else if (percentage >= 71) {
                className = 'high';
                label = 'High Capacity';
            } else if (percentage >= 51) {
                className = 'medium';
                label = 'Moderate';
            } else {
                className = 'low';
                label = 'Available';
            }

            return {
                percentage: percentage,
                class: className,
                label: label,
                width: Math.min(percentage, 100)
            };
        }

        function renderDashboard() {
            const grades = [...new Set(studentData.map(d => d.grade))].sort();
            const dashboardDiv = document.getElementById('dashboard');
            dashboardDiv.innerHTML = '';

            grades.forEach(grade => {
                const gradeData = studentData.filter(d => d.grade === grade)
                    .sort((a, b) => b.count - a.count);

                const section = document.createElement('div');
                section.className = 'grade-section';

                let html = `<div class="grade-header">Grade ${grade}</div>`;
                html += `<div class="subject-grid">`;

                gradeData.forEach(item => {
                    const capacity = capacities[item.key] || 0;
                    const info = getCapacityInfo(item.count, capacity);

                    html += `
                        <div class="subject-card">
                            <div class="subject-header">
                                <div class="subject-name">${item.subject}</div>
                                <div class="subject-numbers">
                                    <div class="current-number">${item.count}</div>
                                    <div class="max-number">/ ${capacity || '‚Äî'}</div>
                                </div>
                            </div>
                            <div class="capacity-bar-container">
                                <div class="capacity-bar ${info.class}" style="width: ${info.width}%">
                                    ${info.percentage > 0 ? info.percentage + '%' : ''}
                                </div>
                            </div>
                            <div class="status-label ${info.class}">${info.label}</div>
                        </div>
                    `;
                });

                html += `</div>`;
                section.innerHTML = html;
                dashboardDiv.appendChild(section);
            });
        }
    </script>
</body>
</html>